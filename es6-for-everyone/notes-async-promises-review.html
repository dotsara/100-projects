<!Doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Notes: Async</title>
</head>
<body>
    <h1>Async!</h1>

    <p>tinkering:</p>
    <video controls class="nosy"></video>
<script>
    // Reviewing promises ahead of refactoring previously-done promises code
    // to be async await.

    // first up: built-in promises
    const response = fetch('https://api.github.com/users/dotsara');
    console.log(response);
    // this isn't the response, it's the promise that a response is forthcoming
    // to listen, we need to attach .then

    // this works but since fetch doesn't assume JSON, what you get back
    // is a whole bunch of stuff that isn't the data you're expecting.
    // fetch('https://api.github.com/users/dotsara')
    //     .then(response => {
    //         console.log(response);
    //     });

    // fetch('https://api.github.com/users/dotsara')
    //     .then(response => {
    //         return response.json();
    //     })
    //     .then(response => {
    //         console.log(response);
    //     });
    // don't forget error catching!

    // fetch('https://apijithub.com/users/dotsara')
    //     .then(response => {
    //         return response.json();
    //     })
    //     .then(response => {
    //         console.log(response);
    //     })
    //     .catch(error => {
    //         console.log(`Hit an error!`);
    //         console.error(error);
    //     });

    // from the Javascript 30 project, fiddling around with getting a
    // user's webcam stream and putting it on the page.
    const video = document.querySelector('.nosy');

    // just logging out the thing we get back
    // navigator.mediaDevices.getUserMedia({video: true})
    //     .then(mediaStream => {
    //         console.log(mediaStream);
    //     } );

    // commented out just so I don't see it in the console while I work
    // on the custom promises part.
    // navigator.mediaDevices.getUserMedia({video: true})
    //     .then(mediaStream => {
    //         video.srcObject = mediaStream;
    //         video.load();
    //         video.play();
    //     })
    //     .catch(err => {
    //         console.error(err);
    //     });

    // next up: custom promises review
    // any function that returns a Promise has a promise-based API
    // and can be used interchangeably with then-then-catch or async await

    // wait for 4 seconds, then move on.
    // function breathe(amount) {
    //     return new Promise((resolve, reject) => {
    //         // a little timer that waits the amount and then resolves
    //         setTimeout(() => resolve(`Done for ${amount} ms`), amount);
    //     });
    // }
    //
    // breathe(1000)
    //     .then(response => {
    //         console.log(response);
    //         return breathe(500);
    //     })
    //     .then(response => {
    //         console.log(response);
    //         return breathe(600);
    //     })
    //     .then(response => {
    //         console.log(response);
    //         return breathe(1200);
    //     })

    // that can go on forever and it's less awful looking than nested-to-hell
    // callbacks. But also: don't forget a reject.

    function breathe(amount) {
        return new Promise((resolve, reject) => {
            if(amount < 500) {
                reject(`${amount} is too small a value`);
            }
            setTimeout(() => resolve(`Done for ${amount} ms`), amount);
        });
    }

    breathe(1000)
        .then(response => {
            console.log(response);
            return breathe(500);
        })
        .then(response => {
            console.log(response);
            return breathe(600);
        })
        .then(response => {
            console.log(response);
            return breathe(100);
        })
        .then(response => {
            console.log(response);
            return breathe(1200);
        })
        .catch(error => {
            console.error('There was a mistake');
            console.error(error);
        })
</script>
</body>
</html>